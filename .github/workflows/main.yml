name: Hacker SSH Server (Pass: 123456)
run-name: üîì Open SSH Port 'root@hacker' by ${{ github.actor }}

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  hacker-ssh-job:
    name: üîì Root SSH Server
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout Repository
        uses: actions/checkout@v4

      # 1. C√†i ƒë·∫∑t giao di·ªán & SSH Server
      - name: üõ†Ô∏è Install SSH & Tools
        run: |
          echo ">>> [INIT] ƒêang c√†i ƒë·∫∑t d·ªãch v·ª•..."
          sudo apt-get update -qq
          # C√†i openssh-server ƒë·ªÉ m·ªü c·ªïng 22
          sudo apt-get install -y -qq openssh-server neofetch nano
          
          # T·ªëi ∆∞u m·∫°ng
          sudo sysctl -w net.core.default_qdisc=fq || true
          sudo sysctl -w net.ipv4.tcp_congestion_control=bbr || true

      # 2. C·∫§U H√åNH M·∫¨T KH·∫®U & SSH (Quan tr·ªçng)
      - name: üîë Setup Password & Enable SSH
        run: |
          echo ">>> [AUTH] ƒêang thi·∫øt l·∫≠p m·∫≠t kh·∫©u..."
          
          # 1. ƒê·∫∑t m·∫≠t kh·∫©u cho user 'runner' l√† 123456
          echo 'runner:123456' | sudo chpasswd
          # ƒê·∫∑t lu√¥n cho 'root' (n·∫øu c·∫ßn)
          echo 'root:123456' | sudo chpasswd
          
          # 2. C·∫•u h√¨nh file sshd_config ƒë·ªÉ cho ph√©p ƒëƒÉng nh·∫≠p b·∫±ng m·∫≠t kh·∫©u
          # (M·∫∑c ƒë·ªãnh GitHub ch·∫∑n password login, ph·∫£i m·ªü ra)
          sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
          sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/g' /etc/ssh/sshd_config
          
          # 3. Kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• SSH ƒë·ªÉ √°p d·ª•ng
          sudo service ssh restart
          
          echo ">>> [DONE] ƒê√£ m·ªü c·ªïng 22. M·∫≠t kh·∫©u l√†: 123456"

      # 3. ƒê·ªïi giao di·ªán th√†nh 'root@hacker'
      - name: üíÄ Hacker Prompt Interface
        run: |
          cat << 'EOF' >> /home/runner/.bashrc
          clear
          neofetch
          # D√≤ng l·ªánh m√†u ƒë·ªè ng·∫ßu ƒë√©t
          export PS1="\[\e[1;31m\]root@hacker\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\]# "
          alias cls='clear'
          EOF
          sudo cp /home/runner/.bashrc /root/.bashrc

      # 4. K·∫øt n·ªëi Tailscale
      - name: üåê Connect to Tailscale VPN
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTH_KEY }}
          version: latest
          args: --accept-routes --hostname=hacker-ssh-box

      # 5. Treo m√°y ch·ªù k·∫øt n·ªëi
      - name: üöÄ Ready for SSH
        run: |
          echo "========================================================"
          echo "   M√ÅY CH·ª¶ ƒê√É S·∫¥N S√ÄNG!"
          echo "   IP Tailscale: $(tailscale ip -4)"
          echo "   L·ªánh k·∫øt n·ªëi: ssh runner@$(tailscale ip -4)"
          echo "   M·∫≠t kh·∫©u:     123456"
          echo "========================================================"
          sleep 6h
          
