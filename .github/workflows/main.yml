name: "Hacker SSH Server (Fixed Manual)"
run-name: "ğŸ”“ Root Shell Fix by ${{ github.actor }}"

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  hacker-manual-job:
    name: "ğŸ”“ Root SSH Server"
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      # 1. CÃ i Ä‘áº·t Giao diá»‡n & SSH (KhÃ´ng dÃ¹ng Snap Ä‘á»ƒ trÃ¡nh lá»—i treo)
      - name: ğŸ› ï¸ Install SSH & Tools
        run: |
          echo ">>> [INIT] Äang cÃ i Ä‘áº·t há»‡ thá»‘ng..."
          sudo apt-get update -qq
          sudo apt-get install -y -qq openssh-server neofetch nano
          
          # Tá»‘i Æ°u máº¡ng
          sudo sysctl -w net.core.default_qdisc=fq || true
          sudo sysctl -w net.ipv4.tcp_congestion_control=bbr || true

      # 2. Cáº¥u hÃ¬nh Máº­t kháº©u & SSH
      - name: ğŸ”‘ Setup Password
        run: |
          # Äáº·t pass 123456
          echo 'runner:123456' | sudo chpasswd
          echo 'root:123456' | sudo chpasswd
          
          # Má»Ÿ khÃ³a SSH password
          sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
          sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/g' /etc/ssh/sshd_config
          sudo service ssh restart

      # 3. CÃ€I Äáº¶T TAILSCALE THá»¦ CÃ”NG (Äá»ƒ nÃ© lá»—i Checksum cá»§a Action)
      - name: ğŸŒ Install Tailscale (Manual)
        run: |
          echo ">>> [VPN] Äang táº£i Tailscale..."
          
          # 1. Táº£i script cÃ i Ä‘áº·t chÃ­nh chá»§
          curl -fsSL https://tailscale.com/install.sh | sh
          
          # 2. Cháº¡y Tailscale á»Ÿ cháº¿ Ä‘á»™ ná»n (Background)
          # --tun=userspace-networking: Quan trá»ng Ä‘á»ƒ cháº¡y Ä‘Æ°á»£c trÃªn GitHub
          sudo tailscaled --tun=userspace-networking --socks5-server=localhost:1055 &
          
          # Äá»£i 5s cho service lÃªn
          sleep 5
          
          # 3. ÄÄƒng nháº­p máº¡ng (DÃ¹ng Key cá»§a báº¡n)
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=hacker-box --accept-routes

      # 4. Giao diá»‡n Hacker 'root@hacker'
      - name: ğŸ’€ Hacker Prompt
        run: |
          cat << 'EOF' >> /home/runner/.bashrc
          clear
          neofetch
          # Dáº¥u nháº¯c lá»‡nh mÃ u Ä‘á»
          export PS1="\[\e[1;31m\]root@hacker\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\]# "
          alias cls='clear'
          EOF
          sudo cp /home/runner/.bashrc /root/.bashrc

      # 5. Treo mÃ¡y
      - name: ğŸš€ Ready for SSH
        run: |
          echo "========================================================"
          echo "   âœ… Káº¾T Ná»I THÃ€NH CÃ”NG!"
          echo "   IP Tailscale: $(tailscale ip -4)"
          echo "   Lá»‡nh: ssh runner@$(tailscale ip -4)"
          echo "   Pass: 123456"
          echo "========================================================"
          sleep 6h
          
